<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì „ì£¼ëŒ€ ì£¼ë³€ì§€ë„ - JJU Map</title>

    <script type="text/javascript" src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=fdfa17b1b09d466f785d5e9124d0e5fe&libraries=services"></script>

    <!-- ê²½ë¡œ ì°¾ê¸° í”„ë¡ì‹œ ì„œë²„ ì„¤ì • -->
    <script>
        // í™˜ê²½ ìë™ ê°ì§€: localhostë©´ ë¡œì»¬ ì„œë²„, ì•„ë‹ˆë©´ í”„ë¡œë•ì…˜
        (function() {
            const isLocal = window.location.hostname === 'localhost' || 
                           window.location.hostname === '127.0.0.1';
            
            if (isLocal) {
                window.JJU_API_BASE = 'http://localhost:3000';
            } else {
                // í”„ë¡œë•ì…˜: Nginx í”„ë¡ì‹œ í†µí•´ /apië¡œ ì ‘ê·¼
                window.JJU_API_BASE = 'https://jju-map.duckdns.org';
            }
            window.JJU_DIRECTIONS_API = window.JJU_API_BASE + '/api/directions';
            
            console.log('[JJU Config] API Base:', window.JJU_API_BASE);
        })();
    </script>

    <link rel="stylesheet" href="style.css">
</head>
<body class="map-page map-page-sidebar">
    <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
    <nav class="top-navbar">
        <div class="navbar-left">
            <a href="index.html" style="display:flex;align-items:center;gap:10px;text-decoration:none;color:white;">
                <svg class="navbar-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                    <circle cx="12" cy="10" r="3"></circle>
                </svg>
                <span class="navbar-title">ì „ì£¼ëŒ€ ì£¼ë³€ì§€ë„</span>
            </a>
        </div>

        <div class="navbar-center">
            <div class="navbar-search">
                <input type="text" id="topSearch" placeholder="ì¥ì†Œ, ì£¼ì†Œ ê²€ìƒ‰...">
                <button class="search-icon-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                </button>
            </div>
        </div>

        <div class="navbar-right">
            <a href="about.html" class="navbar-link">ì†Œê°œ</a>
            <a href="guide.html" class="navbar-link">ì‚¬ìš©ë°©ë²•</a>
        </div>
    </nav>

    <div class="map-layout">
        <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
        <aside class="map-sidebar">
            <div class="sidebar-header">
                <h2>ì¹´í…Œê³ ë¦¬</h2>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-section-title">ìŒì‹ì </h3>
                <button class="sidebar-item" data-keyword="ì „ì²´ìŒì‹ì " data-multi="í•œì‹,ì¤‘ì‹,ì¼ì‹,ì–‘ì‹,ë¶„ì‹">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M7 2v20M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"></path>
                    </svg>
                    ì „ì²´
                </button>
                <button class="sidebar-item" data-keyword="í•œì‹">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M7 2v20M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"></path>
                    </svg>
                    í•œì‹
                </button>
                <button class="sidebar-item" data-keyword="ì¤‘ì‹">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M7 2v20M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"></path>
                    </svg>
                    ì¤‘ì‹
                </button>
                <button class="sidebar-item" data-keyword="ì¼ì‹">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M7 2v20M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"></path>
                    </svg>
                    ì¼ì‹
                </button>
                <button class="sidebar-item" data-keyword="ì–‘ì‹">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M7 2v20M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"></path>
                    </svg>
                    ì–‘ì‹
                </button>
                <button class="sidebar-item" data-keyword="ë¶„ì‹">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2M7 2v20M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"></path>
                    </svg>
                    ë¶„ì‹
                </button>
            </div>

            <div class="sidebar-section">
                <h3 class="sidebar-section-title">ê¸°íƒ€</h3>
                <button class="sidebar-item" data-keyword="ì¹´í˜">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 8h1a4 4 0 1 1 0 8h-1M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"></path>
                        <path d="M6 2v4M10 2v4M14 2v4"></path>
                    </svg>
                    ì¹´í˜
                </button>
                <button class="sidebar-item" data-keyword="í¸ì˜ì ">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9h18v10a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9Z"></path>
                        <path d="M3 9V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v4"></path>
                    </svg>
                    í¸ì˜ì 
                </button>
                <button class="sidebar-item" data-keyword="ì•½êµ­">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2v20M2 12h20"></path>
                    </svg>
                    ì•½êµ­
                </button>
                <button class="sidebar-item" data-keyword="ë³‘ì›">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2v20M2 12h20"></path>
                        <rect x="4" y="4" width="16" height="16" rx="2"></rect>
                    </svg>
                    ë³‘ì›
                </button>
                <button class="sidebar-item" data-keyword="ì€í–‰">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="6" width="20" height="12" rx="2"></rect>
                        <circle cx="12" cy="12" r="2"></circle>
                        <path d="M6 12h.01M18 12h.01"></path>
                    </svg>
                    ì€í–‰/ATM
                </button>
                <button class="sidebar-item" data-keyword="ë¬¸êµ¬ì ">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                        <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                        <path d="M2 2l7.586 7.586"></path>
                    </svg>
                    ë¬¸êµ¬ì 
                </button>
                <button class="sidebar-item" data-keyword="ë¯¸ìš©ì‹¤">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M2 12h20M2 12a10 10 0 0 1 10-10M2 12a10 10 0 0 0 10 10"></path>
                    </svg>
                    ë¯¸ìš©ì‹¤
                </button>
                <button class="sidebar-item" data-keyword="PCë°©">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="3" width="20" height="14" rx="2"></rect>
                        <path d="M8 21h8M12 17v4"></path>
                    </svg>
                    PCë°©
                </button>
                <button class="sidebar-item" data-keyword="í—¬ìŠ¤ì¥">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6.5 6.5h11M6.5 17.5h11M3 12h18"></path>
                        <circle cx="12" cy="12" r="2"></circle>
                    </svg>
                    í—¬ìŠ¤ì¥
                </button>
                <button class="sidebar-item" data-keyword="ë…¸ë˜ë°©">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 18V5l12-2v13"></path>
                        <circle cx="6" cy="18" r="3"></circle>
                        <circle cx="18" cy="16" r="3"></circle>
                    </svg>
                    ë…¸ë˜ë°©
                </button>
            </div>
        </aside>

        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="map-main">
            <!-- ì¹´í…Œê³ ë¦¬ í—¤ë” -->
            <div class="map-content-header">
                <div class="content-header-icon" id="categoryIcon">ğŸ’Š</div>
                <div>
                    <h1 class="content-header-title" id="categoryTitle">ì•½êµ­</h1>
                    <p class="content-header-desc" id="categoryDesc">ì£¼ë³€ì˜ ì•½êµ­ì„ í™•ì¸í•˜ì„¸ìš”</p>
                </div>
            </div>

            <!-- 3ì—´ ì»¨í…Œì´ë„ˆ -->
            <div class="three-column-container">
                <!-- ì§€ë„ ì˜ì—­ -->
                <div class="map-container">
                    <div id="map" class="map-area"></div>
                </div>

                <!-- ê²°ê³¼ ëª©ë¡ -->
                <div class="results-section">
                    <div class="results-header">
                        <h2>ì£¼ë³€ ì¥ì†Œ</h2>
                        <span class="results-count" id="resultsCount">0ê°œ</span>
                    </div>
                    <div class="results-list" id="places-list"></div>
                </div>
            </div>
        </main>
    </div>


    <script src="map.js"></script>
    <script>
        let currentMap = null;
        const categoryInfo = {
            'ì „ì²´ìŒì‹ì ': { icon: 'ğŸ½ï¸', title: 'ì „ì²´ ìŒì‹ì ', desc: 'ì£¼ë³€ì˜ ëª¨ë“  ìŒì‹ì ì„ í™•ì¸í•˜ì„¸ìš”' },
            'í•œì‹': { icon: 'ğŸš', title: 'í•œì‹', desc: 'ì£¼ë³€ì˜ í•œì‹ë‹¹ì„ í™•ì¸í•˜ì„¸ìš”' },
            'ì¤‘ì‹': { icon: 'ğŸ¥Ÿ', title: 'ì¤‘ì‹', desc: 'ì£¼ë³€ì˜ ì¤‘ì‹ë‹¹ì„ í™•ì¸í•˜ì„¸ìš”' },
            'ì¼ì‹': { icon: 'ğŸ£', title: 'ì¼ì‹', desc: 'ì£¼ë³€ì˜ ì¼ì‹ë‹¹ì„ í™•ì¸í•˜ì„¸ìš”' },
            'ì–‘ì‹': { icon: 'ğŸ•', title: 'ì–‘ì‹', desc: 'ì£¼ë³€ì˜ ì–‘ì‹ë‹¹ì„ í™•ì¸í•˜ì„¸ìš”' },
            'ë¶„ì‹': { icon: 'ğŸ¢', title: 'ë¶„ì‹', desc: 'ì£¼ë³€ì˜ ë¶„ì‹ì§‘ì„ í™•ì¸í•˜ì„¸ìš”' },
            'ì¹´í˜': { icon: 'â˜•', title: 'ì¹´í˜', desc: 'ì£¼ë³€ì˜ ì¹´í˜ë¥¼ í™•ì¸í•˜ì„¸ìš”' },
            'í¸ì˜ì ': { icon: 'ğŸª', title: 'í¸ì˜ì ', desc: 'ì£¼ë³€ì˜ í¸ì˜ì ì„ í™•ì¸í•˜ì„¸ìš”' },
            'ì•½êµ­': { icon: 'ğŸ’Š', title: 'ì•½êµ­', desc: 'ì£¼ë³€ì˜ ì•½êµ­ì„ í™•ì¸í•˜ì„¸ìš”' },
            'ë³‘ì›': { icon: 'ğŸ¥', title: 'ë³‘ì›', desc: 'ì£¼ë³€ì˜ ë³‘ì›ì„ í™•ì¸í•˜ì„¸ìš”' },
            'ì€í–‰': { icon: 'ğŸ¦', title: 'ì€í–‰/ATM', desc: 'ì£¼ë³€ì˜ ì€í–‰ê³¼ ATMì„ í™•ì¸í•˜ì„¸ìš”' },
            'ë¬¸êµ¬ì ': { icon: 'âœï¸', title: 'ë¬¸êµ¬ì ', desc: 'ì£¼ë³€ì˜ ë¬¸êµ¬ì ì„ í™•ì¸í•˜ì„¸ìš”' },
            'ë¯¸ìš©ì‹¤': { icon: 'ğŸ’‡', title: 'ë¯¸ìš©ì‹¤', desc: 'ì£¼ë³€ì˜ ë¯¸ìš©ì‹¤ì„ í™•ì¸í•˜ì„¸ìš”' },
            'PCë°©': { icon: 'ğŸ’»', title: 'PCë°©', desc: 'ì£¼ë³€ì˜ PCë°©ì„ í™•ì¸í•˜ì„¸ìš”' },
            'í—¬ìŠ¤ì¥': { icon: 'ğŸ’ª', title: 'í—¬ìŠ¤ì¥', desc: 'ì£¼ë³€ì˜ í—¬ìŠ¤ì¥ì„ í™•ì¸í•˜ì„¸ìš”' },
            'ë…¸ë˜ë°©': { icon: 'ğŸ¤', title: 'ë…¸ë˜ë°©', desc: 'ì£¼ë³€ì˜ ë…¸ë˜ë°©ì„ í™•ì¸í•˜ì„¸ìš”' }
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.addEventListener('load', function() {
            currentMap = initializeMap();

            // ì¦ê²¨ì°¾ê¸° ë²„íŠ¼ ìƒì„±
            if (currentMap && typeof createFavoritesButton === 'function') {
                createFavoritesButton(currentMap);
            }

            // URL íŒŒë¼ë¯¸í„°ì—ì„œ ì¹´í…Œê³ ë¦¬ ì½ê¸°
            const urlParams = new URLSearchParams(window.location.search);
            const category = urlParams.get('category') || 'ì¹´í˜';

            if (currentMap) {
                searchCategory(category);
                updateCategoryHeader(category);
            }
        });

        // ì‚¬ì´ë“œë°” ì•„ì´í…œ í´ë¦­
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', function() {
                const keyword = this.dataset.keyword;
                const multiKeywords = this.dataset.multi;

                // í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
                document.querySelectorAll('.sidebar-item').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');

                // ê²€ìƒ‰ ì‹¤í–‰
                if (multiKeywords) {
                    searchCategory(null, multiKeywords.split(','));
                    updateCategoryHeader('ì „ì²´ìŒì‹ì ');
                } else {
                    searchCategory(keyword);
                    updateCategoryHeader(keyword);
                }
            });
        });

        // ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰ í•¨ìˆ˜
        function searchCategory(keyword, multiKeywords = null) {
            if (!currentMap) return;

            if (multiKeywords) {
                searchMultipleKeywords(multiKeywords, currentMap, function(results) {
                    displayMarkersOnMap(results);
                    displayResultsInPanel(results);
                });
            } else {
                searchPlacesByKeyword(keyword, currentMap, function(results) {
                    displayMarkersOnMap(results);
                    displayResultsInPanel(results);
                });
            }
        }

        // ë§ˆì»¤ í‘œì‹œ
        function displayMarkersOnMap(results) {
            displayMarkers(results, currentMap);
        }

        // íŒ¨ë„ì— ê²°ê³¼ í‘œì‹œ (map.jsì˜ displayResultsList ì‚¬ìš©)
        function displayResultsInPanel(results) {
            // ê²°ê³¼ ê°œìˆ˜ ì—…ë°ì´íŠ¸
            document.getElementById('resultsCount').textContent = results.length + 'ê°œ';
            
            // map.jsì˜ ì¦ê²¨ì°¾ê¸° ê¸°ëŠ¥ì´ í¬í•¨ëœ ê²°ê³¼ ëª©ë¡ í‘œì‹œ í•¨ìˆ˜ ì‚¬ìš©
            if (typeof displayPlacesList === 'function') {
                displayPlacesList(results, currentMap);
            } else {
                console.error('displayPlacesList í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
        }

        // ì¹´í…Œê³ ë¦¬ í—¤ë” ì—…ë°ì´íŠ¸
        function updateCategoryHeader(keyword) {
            const info = categoryInfo[keyword] || { icon: 'ğŸ“', title: keyword, desc: `ì£¼ë³€ì˜ ${keyword}ì„ í™•ì¸í•˜ì„¸ìš”` };
            document.getElementById('categoryIcon').textContent = info.icon;
            document.getElementById('categoryTitle').textContent = info.title;
            document.getElementById('categoryDesc').textContent = info.desc;
        }

        // ê²€ìƒ‰ ê¸°ëŠ¥
        document.getElementById('topSearch').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        document.querySelector('.search-icon-btn').addEventListener('click', performSearch);

        function performSearch() {
            const query = document.getElementById('topSearch').value.trim();
            if (!query) return;

            searchCategory(query);
            updateCategoryHeader(query);
        }
    </script>
</body>
</html>
